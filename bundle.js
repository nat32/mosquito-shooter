(()=>{"use strict";const e=window.Phaser;class t extends e.Scene{constructor(){super({key:"BootScene"})}preload(){this.load.json("animations_json","assets/data/animations.json")}create(){this.scene.start("PreloadScene")}}const s=Object.freeze({ENEMY_INIT:"ENEMY_INIT",ENEMY_DESTROYED:"ENEMY_DESTROYED",PLAYER_SPAWN:"PLAYER_SPAWN",PLAYER_DESTROYED:"PLAYER_DESTROYED",GAME_OVER:"GAME_OVER"});class i extends Phaser.Events.EventEmitter{constructor(){super()}}class n{#e;#t;#s;#i;#n;constructor(e,t,i,n){this.#e=e,this.#i=this.#e.add.group({name:`${this.constructor.name}-${Phaser.Math.RND.uuid()}`,classType:t,runChildUpdate:!0,createCallback:e=>{e.init(n)}}),this.#t=i.interval,this.#s=i.spawnAt,this.#n=!1,this.#e.events.on(Phaser.Scenes.Events.UPDATE,this.update,this),this.#e.physics.world.on(Phaser.Physics.Arcade.Events.WORLD_STEP,this.worldStep,this),this.#e.events.once(Phaser.Scenes.Events.DESTROY,()=>{this.#e.events.off(Phaser.Scenes.Events.UPDATE,this.update,this),this.#e.physics.world.off(Phaser.Physics.Arcade.Events.WORLD_STEP,this.worldStep,this)},this),n.on(s.GAME_OVER,()=>{this.#n=!0})}get phaserGroup(){return this.#i}update(e,t){if(this.#n)return;if(this.#s-=t,this.#s>0)return;const s=Phaser.Math.RND.between(30,this.#e.scale.width-30);this.#i.get(s,-20).reset(),this.#s=this.#t}worldStep(e){this.#i.getChildren().forEach(e=>{e.active&&e.y>this.#e.scale.height+50&&(e.setActive(!1),e.setVisible(!1))})}}class o{#o;constructor(e){this.#o=e}collideWithEnemyShip(){this.#o.isDead||this.#o.die()}collideWithEnemyProjectile(){this.#o.isDead||this.#o.hit()}}class h{#h;#a;#r;constructor(e){this.#h=e,this.#a=e,this.#r=!1}get life(){return this.#a}get isDead(){return this.#r}reset(){this.#a=this.#h,this.#r=!1}hit(){this.#r||(this.#a-=1,this.#a<=0&&(this.#r=!0))}die(){this.#a=0,this.#r=!0}}class a{_up;_down;_left;_right;_shoot;constructor(){this.reset()}get leftIsDown(){return this._left}get rightIsDown(){return this._right}get downIsDown(){return this._down}get upIsDown(){return this._up}get shootIsDown(){return this._shoot}reset(){this._up=!1,this._down=!1,this._left=!1,this._right=!1,this._shoot=!1}}class r extends a{constructor(){super(),this._down=!0}update(){}}class c{#c;#p;#l;constructor(e,t,s){this.#c=e,this.#p=t,this.#l=s,this.#c.body.setDamping(!0),this.#c.body.setDrag(.01),this.#c.body.setMaxVelocity(200)}reset(){this.#c.body.velocity.y=0,this.#c.body.setAngularAcceleration(0)}update(){this.#p.downIsDown?this.#c.body.velocity.y+=this.#l:this.#p.upIsDown?this.#c.body.velocity.y-=this.#l:this.#c.body.setAngularAcceleration(0)}}class p extends Phaser.GameObjects.Container{#m;#d;#p;#u;#o;#C;#y;constructor(e,t,s){super(e,t,s,[]),this.#m=!1,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.body.setSize(24,24),this.body.setOffset(-12,-12),this.#y=e.add.sprite(0,0,"fighter_mosquito",0),this.add([this.#y]),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update,this),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.update,this)},this)}get colliderComponent(){return this.#C}get healthComponent(){return this.#o}get enemyAssetKey(){return"fighter_mosquito"}get enemyDestroyedAnimationKey(){return"explosion"}init(e){this.#d=e,this.#p=new r,this.#u=new c(this,this.#p,12),this.#o=new h(3),this.#C=new o(this.#o),this.#d.emit(s.ENEMY_INIT,this),this.#m=!0}reset(){this.setActive(!0),this.setVisible(!0),this.#o.reset(),this.#u.reset()}update(e,t){this.#m&&this.active&&(this.#o.isDead&&(this.setActive(!1),this.setVisible(!1),this.#d.emit(s.ENEMY_DESTROYED,this)),this.#p.update(),this.#u.update())}}class l extends a{#c;#v;#g;constructor(e){super(),this.#c=e,this.#v=this.#c.x,this.#g=40,this._right=!0,this._down=!0,this._left=!1}set startX(e){this.#v=e}update(){this.#c.x>this.#v+this.#g?(this._left=!0,this._right=!1):this.#c.x<this.#v-this.#g&&(this._left=!1,this._right=!0)}}class m{#c;#p;#l;constructor(e,t,s){this.#c=e,this.#p=t,this.#l=s,this.#c.body.setDamping(!0),this.#c.body.setDrag(.01),this.#c.body.setMaxVelocity(200)}reset(){this.#c.body.velocity.x=0,this.#c.body.setAngularAcceleration(0)}update(){this.#p.leftIsDown?this.#c.body.velocity.x-=this.#l:this.#p.rightIsDown?this.#c.body.velocity.x+=this.#l:this.#c.body.setAngularAcceleration(0)}}class d extends Phaser.GameObjects.Container{#m;#d;#p;#b;#u;#o;#C;#y;constructor(e,t,s){super(e,t,s,[]),this.#m=!1,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.body.setSize(24,24),this.body.setOffset(-12,-12),this.#y=e.add.sprite(0,0,"scout_mosquito",0),this.add([this.#y]),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update,this),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.update,this)},this)}get colliderComponent(){return this.#C}get healthComponent(){return this.#o}get enemyAssetKey(){return"scout_mosquito"}get enemyDestroyedAnimationKey(){return"explosion"}init(e){this.#d=e,this.#p=new l(this),this.#b=new m(this,this.#p,9),this.#u=new c(this,this.#p,10),this.#o=new h(2),this.#C=new o(this.#o),this.#d.emit(s.ENEMY_INIT,this),this.#m=!0}reset(){this.setActive(!0),this.setVisible(!0),this.#o.reset(),this.#p.startX=this.x,this.#u.reset(),this.#b.reset()}update(e,t){this.#m&&this.active&&(this.#o.isDead&&(this.setActive(!1),this.setVisible(!1),this.#d.emit(s.ENEMY_DESTROYED,this)),this.#p.update(),this.#b.update(),this.#u.update())}}class u extends a{#E;#w;constructor(e){super(),this.#E=e.input.keyboard.createCursorKeys(),this.#w=!1}set lockInput(e){this.#w=e}update(){this.#w?this.reset():(this._up=this.#E.up.isDown,this._down=this.#E.down.isDown,this._left=this.#E.left.isDown,this._right=this.#E.right.isDown,this._shoot=this.#E.space.isDown)}}class C{#c;#p;#f;#S;#O;constructor(e,t,s){this.#c=e,this.#p=t,this.#O=s,this.#S=0,this.#f=this.#c.scene.physics.add.group({name:`bullets-${Phaser.Math.RND.uuid()}`,enable:!1}),this.#f.createMultiple({key:"slipper",quantity:this.#O.maxCount,active:!1,visible:!1}),this.#c.scene.physics.world.on(Phaser.Physics.Arcade.Events.WORLD_STEP,this.worldStep,this),this.#c.once(Phaser.GameObjects.Events.DESTROY,()=>{this.#c.scene.physics.world.off(Phaser.Physics.Arcade.Events.WORLD_STEP,this.worldStep,this)},this)}get bulletGroup(){return this.#f}update(e){if(this.#S-=e,!(this.#S>0)&&this.#p.shootIsDown){const e=this.#f.getFirstDead();if(null==e)return;const t=this.#c.x,s=this.#c.y+this.#O.yOffset;e.enableBody(!0,t,s,!0,!0),e.body.velocity.y-=this.#O.speed,e.setState(this.#O.lifespan),e.setScale(1),e.body.setSize(14,18),e.setFlipY(this.#O.flipY),this.#S=this.#O.interval}}worldStep(e){this.#f.getChildren().forEach(t=>{t.active&&(t.state-=e,t.state<=0&&t.disableBody(!0,!0))})}destroyBullet(e){e.setState(0)}}class y extends Phaser.GameObjects.Container{#D;#P;#b;#o;#C;#d;#_;constructor(e,t){super(e,e.scale.width/2,e.scale.height-32,[]),this.#d=t,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.body.setSize(36,36),this.body.setOffset(-18,-18),this.body.setCollideWorldBounds(!0),this.setDepth(2),this.#_=e.add.sprite(0,0,"man"),this.add([this.#_]),this.#D=new u(this.scene),this.#b=new m(this,this.#D,20),this.#P=new C(this,this.#D,{speed:300,lifespan:3,interval:300,maxCount:10,yOffset:-20,flipY:!1}),this.#o=new h(4),this.#C=new o(this.#o),this.#A(),this.#d.on(s.PLAYER_SPAWN,this.#j,this),this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.update,this),this.once(Phaser.GameObjects.Events.DESTROY,()=>{this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.update,this)},this)}get weaponGameObjectGroup(){return this.#P.bulletGroup}get weaponComponent(){return this.#P}get colliderComponent(){return this.#C}get healthComponent(){return this.#o}update(e,t){if(this.active){if(this.#o.isDead)return this.#A(),this.setVisible(!0),this.#_.play({key:"explosion"}),void this.#d.emit(s.PLAYER_DESTROYED);this.#_.setFrame((4-this.#o.life).toString(10)),this.#D.update(),this.#b.update(),this.#P.update(t)}}#A(){this.setActive(!1),this.setVisible(!1),this.#D.lockInput=!0}#j(){this.setActive(!0),this.setVisible(!0),this.#_.setTexture("man",0),this.#o.reset(),this.setPosition(this.scene.scale.width/2,this.scene.scale.height-32),this.#D.lockInput=!1}}class v{#e;#i;#d;constructor(e,t){this.#e=e,this.#d=t,this.#i=this.#e.add.group({name:`${this.constructor.name}-${Phaser.Math.RND.uuid()}`}),this.#d.on(s.ENEMY_DESTROYED,e=>{this.#i.get(e.x,e.y,e.enemyAssetKey,0).play({key:e.enemyDestroyedAnimationKey})})}}class g extends Phaser.GameObjects.Text{#d;#x;constructor(e,t){super(e,e.scale.width/2,20,"0",{fontSize:"32px",color:"#bd2e54"}),this.scene.add.existing(this),this.#d=t,this.#x=0,this.setOrigin(.5),this.#d.on(s.ENEMY_DESTROYED,e=>{"p"===e.constructor.name?this.#x+=100:this.#x+=200,this.setText(this.#x.toString(10))})}}class b extends Phaser.GameObjects.Container{#I;#d;constructor(e,t){super(e,5,e.scale.height-30,[]),this.#d=t,this.#I=3,this.scene.add.existing(this);for(let t=0;t<this.#I;t+=1){const s=e.add.image(20*t,0,"drop").setScale(.4).setOrigin(0);this.add(s)}this.#d.on(s.PLAYER_DESTROYED,()=>{this.#I-=1,this.getAt(this.#I).destroy(),this.#I>0?e.time.delayedCall(1500,()=>{this.#d.emit(s.PLAYER_SPAWN)}):(this.scene.add.text(this.scene.scale.width/2,this.scene.scale.height/2,"GAME OVER",{fontSize:"30px",color:"#000000"}).setOrigin(.5),this.#d.emit(s.GAME_OVER))}),this.#d.emit(s.PLAYER_SPAWN)}}class E extends e.Scene{constructor(){super({key:"GameScene"})}preload(){this.load.pack("asset_pack","assets/data/assets.json")}create(){const e=new i,t=new y(this,e),o=new n(this,d,{interval:5e3,spawnAt:1e3},e),h=new n(this,p,{interval:6e3,spawnAt:3e3},e);new v(this,e),this.physics.add.overlap(t,o.phaserGroup,(e,t)=>{e.active&&t.active&&(e.colliderComponent.collideWithEnemyShip(),t.colliderComponent.collideWithEnemyShip())}),this.physics.add.overlap(t,h.phaserGroup,(e,t)=>{e.active&&t.active&&(e.colliderComponent.collideWithEnemyShip(),t.colliderComponent.collideWithEnemyShip())}),e.on(s.ENEMY_INIT,e=>{"FighterMosquitoEnemy"===e.constructor.name&&this.physics.add.overlap(t,e.weaponGameObjectGroup,(t,s)=>{t.active&&s.active&&(e.weaponComponent.destroyBullet(s),t.colliderComponent.collideWithEnemyProjectile())})}),this.physics.add.overlap(o.phaserGroup,t.weaponGameObjectGroup,(e,s)=>{e.active&&s.active&&(t.weaponComponent.destroyBullet(s),e.colliderComponent.collideWithEnemyProjectile())}),this.physics.add.overlap(h.phaserGroup,t.weaponGameObjectGroup,(e,s)=>{e.active&&s.active&&(t.weaponComponent.destroyBullet(s),e.colliderComponent.collideWithEnemyProjectile())}),new g(this,e),new b(this,e)}}class w extends e.Scene{constructor(){super({key:"PreloadScene"})}preload(){this.load.pack("asset_pack","assets/data/assets.json")}create(){this.#M(),this.scene.start("GameScene")}#M(){this.cache.json.get("animations_json").forEach(e=>{const t=e.frames?this.anims.generateFrameNumbers(e.assetKey,{frames:e.frames}):this.anims.generateFrameNumbers(e.assetKey);this.anims.create({key:e.key,frames:t,frameRate:e.frameRate,repeat:e.repeat})})}}const f=new e.Game({type:e.CANVAS,roundPixels:!0,pixelArt:!0,scale:{parent:"game-container",width:450,height:640,autoCenter:e.Scale.CENTER_BOTH,mode:e.Scale.HEIGHT_CONTROLS_WIDTH},backgroundColor:"#ffffff",physics:{default:"arcade",arcade:{gravity:{y:0,x:0},debug:!1}}});f.scene.add("BootScene",t),f.scene.add("PreloadScene",w),f.scene.add("GameScene",E),f.scene.start("BootScene")})();